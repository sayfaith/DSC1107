---
title: "DSC1107 FA3"
author: "Lindsay Faith Bazar"
date: "February 23, 2025"
output:
  html_document:
    keep_md: true
  md_document: default
---



## 1.1 Import


```r
load("ml_pay.rdata")
mlb_raw <- as_tibble(ml_pay)
print(mlb_raw)
```

```
## # A tibble: 30 × 54
##    payroll avgwin Team.name.2014 p1998 p1999 p2000 p2001 p2002 p2003 p2004 p2005
##      <dbl>  <dbl> <fct>          <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1   1.12   0.490 Arizona Diamo…  31.6  70.5  81.0  81.2 103.   80.6  70.2  63.0
##  2   1.38   0.553 Atlanta Braves  61.7  74.9  84.5  91.9  93.5 106.   88.5  85.1
##  3   1.16   0.454 Baltimore Ori…  71.9  72.2  81.4  72.4  60.5  73.9  51.2  74.6
##  4   1.97   0.549 Boston Red Sox  59.5  71.7  77.9 110.  108.   99.9 125.  121. 
##  5   1.46   0.474 Chicago Cubs    49.8  42.1  60.5  64.0  75.7  79.9  91.1  87.2
##  6   1.32   0.511 Chicago White…  35.2  24.5  31.1  62.4  57.1  51.0  65.2  75.2
##  7   1.02   0.486 Cincinnati Re…  20.7  73.3  46.9  45.2  45.1  59.4  43.1  59.7
##  8   0.999  0.496 Cleveland Ind…  59.5  54.4  75.9  92.0  78.9  48.6  34.6  41.8
##  9   1.03   0.463 Colorado Rock…  47.7  55.4  61.1  71.1  56.9  67.2  64.6  47.8
## 10   1.43   0.482 Detroit Tigers  19.2  35.0  58.3  49.8  55.0  49.2  46.4  69.0
## # ℹ 20 more rows
## # ℹ 43 more variables: p2006 <dbl>, p2007 <dbl>, p2008 <dbl>, p2009 <dbl>,
## #   p2010 <dbl>, p2011 <dbl>, p2012 <dbl>, p2013 <dbl>, p2014 <dbl>,
## #   X2014 <int>, X2013 <int>, X2012 <int>, X2011 <int>, X2010 <int>,
## #   X2009 <int>, X2008 <int>, X2007 <int>, X2006 <int>, X2005 <int>,
## #   X2004 <int>, X2003 <int>, X2002 <int>, X2001 <int>, X2000 <int>,
## #   X1999 <int>, X1998 <int>, X2014.pct <dbl>, X2013.pct <dbl>, …
```

```r
dim(mlb_raw) 
```

```
## [1] 30 54
```

The dataset contains 30 rows and 54 columns. The column names such as the `payroll`, `avgwin`, and `p1998` to `x2014` is consistent with the data description of winning records and the payroll data of all 30 MLB teams from 1998 to 2014. 

## 1.2 Tidy


```r
tidy_names <- c("team", "payroll_aggregate", "pct_wins_aggregate")
mlb_aggregate <- mlb_raw %>% 
  select(Team.name.2014, payroll, avgwin) %>% 
  rename_with(~tidy_names)

print(mlb_aggregate)
```

```
## # A tibble: 30 × 3
##    team                 payroll_aggregate pct_wins_aggregate
##    <fct>                            <dbl>              <dbl>
##  1 Arizona Diamondbacks             1.12               0.490
##  2 Atlanta Braves                   1.38               0.553
##  3 Baltimore Orioles                1.16               0.454
##  4 Boston Red Sox                   1.97               0.549
##  5 Chicago Cubs                     1.46               0.474
##  6 Chicago White Sox                1.32               0.511
##  7 Cincinnati Reds                  1.02               0.486
##  8 Cleveland Indians                0.999              0.496
##  9 Colorado Rockies                 1.03               0.463
## 10 Detroit Tigers                   1.43               0.482
## # ℹ 20 more rows
```

From the mlb_raw data, we selected the team name, total payroll, and aggregated win percentage and renamed the columns to match the names (`team`, `payroll_aggregate`, `pct_wins_aggregate`).


```r
mlb_yearly <- mlb_raw %>%
  pivot_longer(cols = starts_with("p") | starts_with("X"), 
               names_to = "column_name", values_to = "value") %>%
  separate(column_name, into = c("prefix", "year", "suffix"), sep = "(?<=\\D)(?=\\d)|(?<=\\d)(?=\\D)", fill = "right", extra = "drop") %>%
  mutate(tidy_col_name = case_when(
    prefix == "p" ~ "payroll",
    suffix == ".pct" ~ "pct_wins",
    TRUE ~ "num_wins"
  )) %>%
  select(team = Team.name.2014, year, tidy_col_name, value) %>%
  pivot_wider(names_from = tidy_col_name, values_from = value) %>%
  mutate(year = as.integer(year)) %>%
  arrange(team, year)

mlb_yearly <- mlb_yearly %>% drop_na()
print(mlb_yearly)
```

```
## # A tibble: 510 × 5
##    team                  year num_wins payroll pct_wins
##    <fct>                <int>    <dbl>   <dbl>    <dbl>
##  1 Arizona Diamondbacks  1998       65    31.6    0.399
##  2 Arizona Diamondbacks  1999      100    70.5    0.613
##  3 Arizona Diamondbacks  2000       85    81.0    0.525
##  4 Arizona Diamondbacks  2001       92    81.2    0.568
##  5 Arizona Diamondbacks  2002       98   103.     0.605
##  6 Arizona Diamondbacks  2003       84    80.6    0.519
##  7 Arizona Diamondbacks  2004       51    70.2    0.315
##  8 Arizona Diamondbacks  2005       77    63.0    0.475
##  9 Arizona Diamondbacks  2006       76    59.7    0.469
## 10 Arizona Diamondbacks  2007       90    52.1    0.552
## # ℹ 500 more rows
```


In this code, we converted the wide-format yearly data into long format using `pivot_longer()`.
We also splits the column names into prefix (p/X), year (1998-2014), and suffix (.pct or blank) and assigns the correct names from
`p` → `payroll`, `.pct` → `pct_wins`, and other values → `num_wins.`


```r
dim(mlb_aggregate)
```

```
## [1] 30  3
```

```r
dim(mlb_yearly)
```

```
## [1] 510   5
```

The `mlb_aggregate` (Aggregate Data) contains one row per team. Since there are 30 MLB teams, mlb_aggregate has 30 rows. This dataset summarizes total payroll and win percentage over the years (1998-2014).

While the `mlb_yearly` (Yearly Data) contains one row per team per year. Since there are 30 teams and 17 years (1998-2014), mlb_yearly has:
30 teams × 17 years = 510 rows This dataset includes payroll, win percentage, and total wins for each team in each year.

## 1.3 Quality Control



```r
mlb_aggregate_computed <- mlb_yearly %>% 
  group_by(team) %>% 
  summarize(payroll_aggregate_computed = sum(payroll, na.rm = TRUE),
            pct_wins_aggregate_computed = mean(pct_wins, na.rm = TRUE))

mlb_aggregate_computed
```

```
## # A tibble: 30 × 3
##    team                 payroll_aggregate_computed pct_wins_aggregate_computed
##    <fct>                                     <dbl>                       <dbl>
##  1 Arizona Diamondbacks                      1223.                       0.492
##  2 Atlanta Braves                            1518.                       0.563
##  3 Baltimore Orioles                         1305.                       0.457
##  4 Boston Red Sox                            2104.                       0.551
##  5 Chicago Cubs                              1552.                       0.475
##  6 Chicago White Sox                         1375.                       0.507
##  7 Cincinnati Reds                           1119.                       0.491
##  8 Cleveland Indians                         1113.                       0.505
##  9 Colorado Rockies                          1129.                       0.463
## 10 Detroit Tigers                            1484.                       0.474
## # ℹ 20 more rows
```


```r
mlb_aggregate_joined <- mlb_aggregate %>%
  inner_join(mlb_aggregate_computed, by = "team")

mlb_aggregate_joined
```

```
## # A tibble: 30 × 5
##    team              payroll_aggregate pct_wins_aggregate payroll_aggregate_co…¹
##    <fct>                         <dbl>              <dbl>                  <dbl>
##  1 Arizona Diamondb…             1.12               0.490                  1223.
##  2 Atlanta Braves                1.38               0.553                  1518.
##  3 Baltimore Orioles             1.16               0.454                  1305.
##  4 Boston Red Sox                1.97               0.549                  2104.
##  5 Chicago Cubs                  1.46               0.474                  1552.
##  6 Chicago White Sox             1.32               0.511                  1375.
##  7 Cincinnati Reds               1.02               0.486                  1119.
##  8 Cleveland Indians             0.999              0.496                  1113.
##  9 Colorado Rockies              1.03               0.463                  1129.
## 10 Detroit Tigers                1.43               0.482                  1484.
## # ℹ 20 more rows
## # ℹ abbreviated name: ¹​payroll_aggregate_computed
## # ℹ 1 more variable: pct_wins_aggregate_computed <dbl>
```


```r
p1 <- ggplot(mlb_aggregate_joined, aes(x = payroll_aggregate, y = payroll_aggregate_computed)) +
  geom_point() + geom_abline(slope = 1, intercept = 0, linetype = "dashed")

p2 <- ggplot(mlb_aggregate_joined, aes(x = pct_wins_aggregate, y = pct_wins_aggregate_computed)) +
  geom_point() + geom_abline(slope = 1, intercept = 0, linetype = "dashed")

plot_grid(p1, p2, labels = c("Payroll", "Win %"))
```

![](DSC1107-FA3_files/figure-html/unnamed-chunk-6-1.png)<!-- -->

The computed and provided aggregate statistics for payroll and win percentage show a strong alignment. Both scatter plots reveal that the computed values closely match the original values, as indicated by the clustering of points along the diagonal reference line. This suggests high accuracy in data computation.

## 2.1 Payroll across Years 


```r
ggplot(mlb_yearly, aes(x = as.numeric(year), y = payroll, group = team, color = team)) +
  geom_line(size = 1) +
  facet_wrap(~ team) +
  geom_hline(aes(yintercept = mean(payroll, na.rm = TRUE)), linetype = "dashed", color = "red") +
  theme_minimal() +
  labs(title = "Payroll Trends Across Years", x = "Year", y = "Payroll (in millions)") +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5))
```

![](DSC1107-FA3_files/figure-html/unnamed-chunk-7-1.png)<!-- -->

The dashed red line in each subplot represents the average payroll, which allows us to see how teams' payrolls have increased over time.

## Top payroll teams


```r
top_payroll <- mlb_aggregate_computed %>% 
  arrange(desc(payroll_aggregate_computed)) %>% 
  slice(1:3)

kable(top_payroll, caption = "Top 3 Payroll Teams ")
```



Table: Top 3 Payroll Teams 

|team                | payroll_aggregate_computed| pct_wins_aggregate_computed|
|:-------------------|--------------------------:|---------------------------:|
|New York Yankees    |                   2857.093|                   0.5909819|
|Boston Red Sox      |                   2103.581|                   0.5512860|
|Los Angeles Dodgers |                   1874.194|                   0.5261364|

## Top Teams with Payroll Increase 


```r
payroll_increase <- mlb_yearly %>%
  filter(year %in% c(1998, 2014)) %>%
  select(team, year, payroll) %>%
  pivot_wider(names_from = year, values_from = payroll, names_prefix = "payroll_") %>%
  mutate(pct_increase = (payroll_2014 - payroll_1998) / payroll_1998 * 100) %>%
  arrange(desc(pct_increase)) %>%
  slice_head(n = 3)

kable(payroll_increase, caption = "Top 3 Teams by Payroll Increase (1998-2014)")
```



Table: Top 3 Teams by Payroll Increase (1998-2014)

|team                  | payroll_1998| payroll_2014| pct_increase|
|:---------------------|------------:|------------:|------------:|
|Washington Nationals  |       8.3170|     134.7044|    1519.6277|
|Detroit Tigers        |      19.2375|     162.2285|     743.2932|
|Philadelphia Phillies |      28.6225|     180.0527|     529.0601|

The team with the `payroll_aggregate_computed` (Yankees, Red Sox, Braves) consistently have the highest payroll levels, always above the red dashed line. While the team with the `pct_increase` (Nationals, Tigers, Phillies) are identifiable by their sharp upward trends.

## 2.2 Win Percentage Across Years 


```r
ggplot(mlb_yearly, aes(x = as.numeric(year), y = pct_wins, group = team, color = team)) +
  geom_line(size = 1) +
  facet_wrap(~ team) +
  geom_hline(aes(yintercept = mean(pct_wins, na.rm = TRUE)), linetype = "dashed", color = "red") +
  theme_minimal() +
  labs(title = "Win Percentage Trends Across Years", x = "Year", y = "Win Percentage") +
  theme(legend.position = "none", plot.title = element_text(hjust = 0.5))
```

![](DSC1107-FA3_files/figure-html/unnamed-chunk-10-1.png)<!-- -->

## Top Winning Teams 


```r
top_winning_teams <- mlb_aggregate_computed %>%
  select(team, pct_wins_aggregate_computed) %>%
  arrange(desc(pct_wins_aggregate_computed)) %>%
  slice_head(n = 3)

kable(top_winning_teams, caption = "Top 3 Teams by Aggregate Win Percentage")
```



Table: Top 3 Teams by Aggregate Win Percentage

|team             | pct_wins_aggregate_computed|
|:----------------|---------------------------:|
|New York Yankees |                   0.5909819|
|Atlanta Braves   |                   0.5631539|
|Boston Red Sox   |                   0.5512860|

## Top 3 Most Erratic Teams


```r
top_volatile_teams <- mlb_yearly %>%
  group_by(team) %>%
  summarise(pct_wins_sd = sd(pct_wins, na.rm = TRUE)) %>%
  arrange(desc(pct_wins_sd)) %>%
  slice_head(n = 3)

kable(top_volatile_teams, caption = "Top 3 Most Erratic Teams by Win Percentage")
```



Table: Top 3 Most Erratic Teams by Win Percentage

|team             | pct_wins_sd|
|:----------------|-----------:|
|Houston Astros   |   0.0914336|
|Detroit Tigers   |   0.0897654|
|Seattle Mariners |   0.0892271|

The top three teams by `pct_wins_aggregate_computed` in the plot appear mostly on top of the red line, indicating a high win percentage. While the `pct_wins_sd` appear to have high fluctuations in their win percentage trends, going from above to below the red line and vice versa.

## 2.3 Win Percentage vs Payroll (15 points)


```r
ggplot(mlb_aggregate, aes(x = payroll_aggregate, y = pct_wins_aggregate, label = team)) +
  geom_point(color = "purple", size = 3, alpha = 0.7) +
  geom_text_repel(size = 4) +
  geom_smooth(method = "lm", se = FALSE, color = "black") +
  theme_minimal() +
  labs(title = "Win Percentage vs Payroll", x = "Aggregate Payroll", y = "Aggregate Win Percentage") +
  theme(plot.title = element_text(hjust = 0.5))
```

![](DSC1107-FA3_files/figure-html/unnamed-chunk-13-1.png)<!-- -->

The relationship between payroll and win percentage appears to be positive, as indicated by the upward-sloping trend line in the scatter plot. This means that, generally, teams with higher payrolls tend to have higher win percentages.

This result is expected because teams with higher payrolls can afford to sign better players, including high-performing free agents and experienced talent. Although there are some exceptions such as teams with lower payrolls but performs well or high-payroll teams that underperform, but the overall trend aligns with the general assumption that spending more money on players leads to better performance.

##  2.4 Team Efficiency 


```r
mlb_efficiency <- mlb_aggregate_computed %>% 
  mutate(efficiency = pct_wins_aggregate_computed / payroll_aggregate_computed) %>% 
  arrange(desc(efficiency)) %>% 
  slice(1:3)

kable(mlb_efficiency, caption = "Top 3 Most Efficient Teams")
```



Table: Top 3 Most Efficient Teams

|team              | payroll_aggregate_computed| pct_wins_aggregate_computed| efficiency|
|:-----------------|--------------------------:|---------------------------:|----------:|
|Miami Marlins     |                   698.0929|                   0.4673161|  0.0006694|
|Oakland Athletics |                   887.5729|                   0.5385489|  0.0006068|
|Tampa Bay Rays    |                   776.1869|                   0.4610341|  0.0005940|

The three teams identified as the most efficient in the previous plot (i.e., Win Percentage vs. Payroll) appear efficient in the sense that they have a relatively high win percentage despite having a moderate or lower payroll compared to other teams.
